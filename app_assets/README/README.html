<div style="text-align: center;">
    <img src="logo_full.png" alt="Travis Custom Logo Image" width="70"/>
</div>

<div style="text-align: center;">
    <h1>Speaker Balancer</h1>

    Written by: <b>Travis M. Moore</b>
    <br>
    Latest version: <b>Version 4.0.1</b><br>
    Originally created: <b>June 09, 2022</b><br>
    Last edited: <b>May 06, 2024</b><br><br>
</div>

<hr />
<h1>Description</h1>
<p>The Speaker Balancer is a useful tool for quickly balancing lab speakers using a sound level meter. </p>
<ul>
<li>
<p>Select speakers just by clicking. </p>
</li>
<li>
<p>Present a white Gaussian noise to the specified speaker. </p>
</li>
<li>
<p>Calculate offsets (using the first speaker as a reference). Easily save offsets to CSV, and monitor offsets in real time as they appear on screen. 
<br>
<br></p>
</li>
</ul>
<hr />
<h1>Getting Started</h1>
<h2>Dependencies</h2>
<ul>
<li>Windows 10 or greater (not compatible with Mac OS)</li>
</ul>
<h2>Installing</h2>
<ul>
<li>
<p>This is a compiled app; the executable file is stored on Starfile at: \starfile\Public\Temp\MooreT\Custom Software</p>
</li>
<li>
<p>Simply copy the executable file and paste to a location on the local machine. </p>
</li>
<li>
<p><strong>DO NOT RUN FROM THE STARFILE SERVER.</strong> This ties up the program for others, and will result in erratic app behavior. </p>
</li>
</ul>
<h2>First Use</h2>
<ul>
<li>
<p><strong>DO NOT RUN FROM THE STARFILE SERVER.</strong> This ties up the program for others, and will result in erratic app behavior. That's right, this statement is identical to the one above - it's just that important!</p>
</li>
<li>
<p>Double-click to start the application for the first time.
<br>
<br></p>
</li>
</ul>
<hr />
<h1>Main Screen</h1>
<p>The Speaker Balancer offers all the controls you will need on a single screen for ease of use. Enjoy the sky blue band across the top of the screen - it's almost like being at the beach. </p>
<p><img src="main_window.png" alt="Main Window Image" width="500"/></p>
<h2>Controls</h2>
<h3>Playback Group</h3>
<ul>
<li>
<p>Duration (s): The duration of the white noise in seconds</p>
</li>
<li>
<p>Level (dB): The scaling factor to apply to the white noise. Adjust this level until the sound level meter reads around 70 dB A (slow). </p>
</li>
<li>
<p>Play button: Begin audio playback.</p>
</li>
<li>
<p>Stop button: Stop audio playback.</p>
</li>
</ul>
<h3>Offsets Group</h3>
<ul>
<li>
<p>SLM Reading (dB): The value read from the sound level meter while the white noise is actively playing. </p>
</li>
<li>
<p>Calculate Offset button: Calculates an offset based off of the value from speaker 1 and stores that value. </p>
</li>
</ul>
<h2>Offsets</h2>
<p>The Offsets frame displays the offsets for each speaker as they are calculated. Refer to this section while updating the RME offsets using Total Mix. </p>
<h2>Speaker Number</h2>
<p>The Speak Number group contains buttons for each speaker. Route the white noise to any speaker by clicking the appropriate button. 
<br>
<br></p>
<hr />
<h1>Tools Menu</h1>
<h2>Audio Settings</h2>
<p>The Audio Settings window allows you to select an audio device and assign speakers for playback. </p>
<p><b>Device Selection.</b> The Audio Settings window displays available audio devices in a table (see lower part of image below). Simply click to choose the desired device. Your selection will be highlighted in blue.<br> 
<strong>Important:</strong> DO NOT SELECT ANY DEVICE WITH "ASIO" IN THE NAME. SELECT "Analog (1-8)" WITH 8 OUTPUT CHANNELS. If there are multiple Analog (1-8) options, you will have to guess and check by selecting one, then trying the Tools&gt;Test Offsets function. </p>
<p><b>Speaker Assignment.</b> To assign a speaker for playback, enter the speaker/channel number in the entry box (see upper part of image below). Note that you must provide a speaker for each channel in the audio file. For example, if your stimulus has eight channels, you must provide a list of eight speakers. Separate numbers with spaces when providing a list of speakers. For example: <code>1 2 3 4 5 6 7 8</code>.</p>
<p><img src="audio_settings.png" alt="Audio Settings Window" width="500"/>
<br>
<br></p>
<hr />
<h1>How to Balance Speakers</h1>
<p>The instructions below guide you through the process of using the app to balance the speakers in a given lab. Instructions reference the different color rectangles imposed on the image below.</p>
<p><img src="totalmix2.png" alt="TotalMix image" width="500"/></p>
<ol>
<li>Open TotalMix (see image above)</li>
<li>Click the Snapshot labeled "Default" (green rectangle)</li>
<li>Click the Layout Preset labeled "Default" (green rectangle)</li>
<li>Ensure channels are mapped 1-to-1 (click each channel along the bottom row [Hardware Outputs; blue rectangle], and verify that the corresponding channel along the top row [Software Playback; red rectangle] has the level slider in the 0 position)</li>
<li>Ensure all the yellow values at the bottom of the sliders along the top row [yellow rectangle] are set to 0</li>
<li>Create a new Snapshot and Layout Preset name based on the study (green rectangle)</li>
<li>Create a new Snapshot and Layout Preset from the defaults by clicking the "Store" button (the saved profiles will flash), then click on the new profile (flashing will cease)</li>
<li>Use the Speaker Balancer as described above</li>
<li>Calculated offsets will appear in the "Offsets" group at the far righthand side of the Speaker Balancer screen</li>
<li>Use the offset values from the app to update the yellow values under the sliders of the top row of channels (yellow rectangle)</li>
<li>Navigate to Tools&gt;Test Offsets to automatically step through each speaker, checking that the sound level meter reads a constant value (within a few tenths of a dB) for all speakers
<br>
<br></li>
</ol>
<hr />
<h1>Compiling from Source</h1>
<p><code>pyinstaller --noconfirm --onefile --windowed --icon "C:/Users/MooTra/Code/Python/tmpy/tkgui/shared_assets/images/logo_icons/logo_full.ico" --add-data "C:/Users/MooTra/Code/Python/speaker_balancer/app_assets;app_assets/" --add-data "C:/Users/MooTra/Code/Python/tmpy;tmpy/" --paths "C:/Users/MooTra/Code/Python/tmpy" --hidden-import "numpy" --hidden-import "pandas" --hidden-import "sounddevice" --hidden-import "soundfile" --hidden-import "msoffcrypto" --hidden-import "idlelib"  "C:/Users/MooTra/Code/Python/speaker_balancer/controller.py"</code>
<br>
<br></p>
<hr />
<h1>Contact</h1>
<p>Please use the contact information below to submit bug reports, feature requests and any other feedback.</p>
<ul>
<li>Travis M. Moore: travis_moore@starkey.com</li>
</ul>